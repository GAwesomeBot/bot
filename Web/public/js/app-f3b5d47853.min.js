/* GAwesomeBot by Gilbert - Available under the GPL V2 License - Some rights reserved - https://github.com/GilbertGobbels/GAwesomeBot */
const GAwesomeData={},GAwesomeUtil={},GAwesomePaths={},GAwesomeListeners={};GAwesomeData.activity={guildData:{}},GAwesomeData.blog={editor:{}},GAwesomeData.wiki={bookmarks:JSON.parse(localStorage.getItem("wiki-bookmarks"))||[],editor:{}},GAwesomeData.extensions={},GAwesomeData.timers=[],GAwesomeData.dashboard={servers:{}},GAwesomeUtil.dashboard={},GAwesomeData.config={debug:localStorage.getItem("gab:debug")||!1},GAwesomeData.blog.subtitles=["Dolphin Musings","The fault in our syntax","How to go viral","I wish I were a GAB","A robot's memoir","Why do we exist?","What is love?","Updating GAB; my story","What did I ever do to you?","BitQuote made this happen","I didn't want this either","The tragic story","Developer Vs. Bot","What did we mess up today?","Where are your fingers?","Beautiful Duwang","Nominated for best GAB-related blog","Add to bookmarks, but only if you want to","New posts every randomized time period!","It's like free education","These really aren't funny"],GAwesomeData.extensions.html={start:{"#installer-title":"Installing $EXTNAME","#installer-subtitle":"Extension Information"},config:{global:()=>{GAwesomeData.extensions.state.data.server=GAwesomeData.extensions.servers.find(e=>e.id===$("#installer-serverSelect").val()),$("#installer-selector").hide()},"#installer-continue":()=>'\n\t\t\t\tNext &nbsp;\n\t\t\t\t<span class="icon is-small">\n\t\t\t\t\t<i class="fa fa-arrow-right"></i>\n\t\t\t\t</span>\n\t\t\t',"#installer-subtitle":()=>"Extension Configuration","#installer-content":()=>{let e=`\n\t\t\t\t<div class="box has-text-left">\n\t\t\t\t<h4 class="subtitle is-4">\n\t\t\t\t\tOptions for <strong>${GAwesomeData.extensions.state.extension.name}</strong>\n\t\t\t\t</h4>\n\t\t\t\t`;["keyword","command"].includes(GAwesomeData.extensions.state.extension.type)&&(e+='\n\t\t\t\t<div class="field">\n\t\t\t\t\t<label class="label">Permissions</label>\n\t\t\t\t\t<div class="control">\n\t\t\t\t\t\t<span class="select is-primary">\n\t\t\t\t\t\t\t<select name="installer-adminLevel">\n\t\t\t\t\t\t\t\t<option value="0" selected>@everyone</option>\n\t\t\t\t\t\t\t\t<option value="1">Admin level &ge;1</option>\n\t\t\t\t\t\t\t\t<option value="2">Admin level &ge;2</option>\n\t\t\t\t\t\t\t\t<option value="3">Admin level &ge;3</option>\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class="help">The extension will only respond to members that have the selected bot admin level (or higher).</span>\n\t\t\t\t</div>'),e+='\n\t\t\t\t<div class="field">\n\t\t\t\t\t<label class="label">Channel(s)</label>\n\t\t\t\t',$.get(`/api/servers/${GAwesomeData.extensions.state.data.server.id}/channels`,t=>{Object.values(t).filter(e=>"text"===e.type).sort((e,t)=>e.rawPosition-t.rawPosition).forEach(t=>{e+=`\n\t\t\t\t\t\t<label class="checkbox">\n\t\t\t\t\t\t<input name="installer-disabled_channel_ids-${t.id}" class="installer-disabled_channel_ids" type="checkbox">\n\t\t\t\t\t\t\t#${t.name}\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<br>`}),e+='\n\t\t\t\t</div>\n\t\t\t\t<div class="field">\n\t\t\t\t\t<div class="control has-addons">\n\t\t\t\t\t\t<a class="button is-small" onclick="GAwesomeUtil.toggleChannels(\'installer-disabled_channel_ids\', true);">\n\t\t\t\t\t\t\t<span>Select All</span>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<a class="button is-small" onclick="GAwesomeUtil.toggleChannels(\'installer-disabled_channel_ids\', false);">\n\t\t\t\t\t\t\t<span>Deselect All</span>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class="help">The extension will run only in these channels.</span>\n\t\t\t\t</div></div>',$("#installer-content").html(e)})}},confirm:{"#installer-continue":()=>"Install","#installer-subtitle":()=>"Confirmation"}},GAwesomeUtil.setInterval=((...e)=>{const t=setInterval(...e);return GAwesomeData.timers.push(t),t}),GAwesomeUtil.reload=(()=>window.location.reload(!0)),GAwesomeUtil.refresh=(()=>Turbolinks.visit("")),GAwesomeUtil.snapshot=(e=>{const t=document.getElementsByTagName(e)[0];if(!Turbolinks||!Turbolinks.controller)return;const s=Turbolinks.controller.cache.snapshots;return t&&s&&s[window.location.href]&&(s[window.location.href][e]=t.cloneNode(!0)),s[window.location.href]}),GAwesomeUtil.log=((e,t,s)=>{if(GAwesomeData.config.debug||s)return!e||"string"!=typeof e||t&&!["log","warn","error"].includes(t)?console.warn("[GAwesomeBot] [WARN] Invalid Arguments for log()"):void console[t||"log"](`[GAwesomeBot] [${"log"!==t&&t?t.toUpperCase():"DEBUG"}] ${e}`)}),GAwesomeUtil.error=(e=>GAwesomeUtil.log(e,"error",!0)),GAwesomeUtil.warn=(e=>GAwesomeUtil.log(e,"warn",!0)),GAwesomeUtil.debugDump=(()=>{GAwesomeUtil.log("[DUMP:INFO] Pass this information to a GAB Support Member and they will assist you further!","log",!0);const{dashboard:{socket:e},builder:t}=GAwesomeData;GAwesomeData.dashboard.socket&&(GAwesomeData.dashboard.socket={}),GAwesomeData.builder&&(GAwesomeData.builder={}),GAwesomeUtil.log(`[DUMP:APPDATA] ${JSON.stringify(GAwesomeData)}`,"log",!0),GAwesomeData.dashboard.socket=e,GAwesomeData.builder=t,GAwesomeUtil.log(`[DUMP:SESSIONDATA] ${JSON.stringify(localStorage)}`,"log",!0),GAwesomeUtil.log(`[DUMP:LIBDATA] ${JSON.stringify({tl:"undefined"!=typeof Turbolinks,io:"undefined"!=typeof io,np:"undefined"!=typeof NProgress,fs:"undefined"!=typeof saveAs,sa:"undefined"!=typeof swal,ac:"undefined"!=typeof AutoComplete,cm:"undefined"!=typeof CodeMirror,md:"undefined"!=typeof md5})}`,"log",!0)}),GAwesomeUtil.toggleAds=(e=>{document.cookie=`adsPreference=${"true"!==e}; path=/`,GAwesomeUtil.refresh()}),GAwesomeUtil.SFS=(()=>{try{$("#builder-code-box").val(cm.getDoc().getValue())}catch(e){}GAwesomeData.IFS=$("#form").serialize(),GAwesomeData.HUM=!0,$("#form-submit span:nth-child(2)").html("Save"),GAwesomeUtil.snapshot("body")}),GAwesomeUtil.submitForm=(()=>{$("#form-submit").addClass("is-loading"),GAwesomeData.HUM=!0,GAwesomeData.builders&&Object.values(GAwesomeData.builders).forEach(e=>e.save()),$.ajax({method:"POST",url:location.pathname+location.search,data:$("#form").serialize()}).always(e=>{GAwesomeUtil.SFS();const t=$("#form-submit");t.removeClass("is-loading"),"OK"!==e&&200!==e.status&&302!==e.status?(GAwesomeUtil.log(`Failed to save dashboard settings. Server returned status ${e.status}.`,"error"),t.find("span:nth-child(1)").html("<i class='fa fa-exclamation'></i>"),t.find("span:nth-child(2)").html("Error")):t.find("span:nth-child(2)").html("Saved"),$(".menu-modifier").each((e,t)=>{t=$(t);const s=$(t.data("modifies"));t.is(":checked")?s.removeClass("is-hidden"):s.addClass("is-hidden")})})}),GAwesomeUtil.setUserAutocomplete=(e=>{const t=e=>new AutoComplete({selector:".user-autocomplete",minChars:2,source:(t,s)=>{t=t.toLowerCase(),s(e.filter(e=>e.toLowerCase().includes(t)))}}),s=GAwesomeUtil.dashboard.getCache(e,"userlist");if(s)return t(s);$.getJSON(`/api/list/users${e?`?svrid=${e}`:""}`,s=>{t(s),GAwesomeUtil.dashboard.setCache(e,"userlist",s)})}),GAwesomeUtil.updateHeader=(()=>{const e=$(`#nav-${window.location.pathname.split("/")[1]}`);e&&e.addClass("is-tab")}),GAwesomeUtil.toggleChannels=((e,t)=>{const s=document.getElementsByClassName(e),o=s.length;for(let e=0;e<o;e++)s[e].checked=t}),GAwesomeUtil.scrollToTop=(e=>{$("html, body").animate({scrollTop:e?e.offset().top:0},172)}),GAwesomeUtil.switchActivityLayout=(e=>{switch(e?localStorage.setItem("servers-layout",e):(e=localStorage.getItem("servers-layout"))||(localStorage.setItem("servers-layout","grid"),e=localStorage.getItem("servers-layout")),e){case"grid":$("#grid-layout-button").addClass("is-primary"),$("#list-layout").addClass("is-hidden"),$("#grid-layout").removeClass("is-hidden"),$("#list-layout-button").removeClass("is-primary");break;case"list":$("#list-layout-button").addClass("is-primary"),$("#list-layout").removeClass("is-hidden"),$("#grid-layout-button").removeClass("is-primary"),$("#grid-layout").addClass("is-hidden")}}),GAwesomeUtil.activityBanGuild=(e=>{confirm("Are you sure you want to remove this guild from the activity page? It will no longer be visible on this page.")&&$.post("/dashboard/maintainer/servers/server-list",{removeFromActivity:e}).done(()=>{const t=$(`#cardContent-${e}`);GAwesomeData.activity.guildData[e]=t.html(),t.html(`\n\t\t\t\t<a class="has-text-centered is-4" href="javascript:GAwesomeUtil.activityUnbanGuild('${e}')">\n    \t\t\t<span class="icon">\n        \t\t<i class="fa fa-refresh"></i>\n    \t\t\t</span>\n    \t\t\tUndo ban\n\t\t\t\t</a>\n\t\t\t`),t.addClass("has-text-centered")})}),GAwesomeUtil.activityUnbanGuild=(e=>{$.post("/dashboard/maintainer/servers/server-list",{unbanFromActivity:e}).done(()=>{const t=$(`#cardContent-${e}`);t.removeClass("has-text-centered"),t.html(GAwesomeData.activity.guildData[e])})}),GAwesomeUtil.activityViewportUpdate=(e=>{"activity"!==window.location.pathname.split("/")[1]&&"extensions"!==window.location.pathname.split("/")[1]||(e.matches?($(".header-search-box").removeClass("is-large"),document.getElementById("frame").style.paddingLeft="15px",document.getElementById("frame").style.paddingRight="15px","/activity/users"!==window.location.pathname&&GAwesomeUtil.switchActivityLayout("list")):($(".header-search-box").addClass("is-large"),document.getElementById("frame").style.paddingLeft="0px",document.getElementById("frame").style.paddingRight="0px"))}),GAwesomeUtil.uploadContent=((e,t)=>{if(e){const s=new FileReader;s.onload=(e=>{GAwesomeData[t].editor.value(e.target.result)}),s.readAsText(e[0]),document.getElementById("composer-content-upload").value=null}}),GAwesomeUtil.uploadCode=(e=>{if(e){const t=new FileReader;t.onload=(e=>{GAwesomeData.builder.getDoc().setValue(e.target.result)}),t.readAsText(e[0]),document.getElementById("builder-code-upload").value=null}}),GAwesomeUtil.downloadContent=(()=>{const e=new Blob([document.getElementById("composer-content").value],{type:"text/markdown;charset=utf-8"});saveAs(e,`${document.getElementById("composer-title").value||"Untitled"}.md`)}),GAwesomeUtil.downloadCode=(e=>{const t=new Blob([GAwesomeData.builder.getValue()],{type:"text/markdown;charset=utf-8"});saveAs(t,`${e||document.getElementById("builder-title").value||"Untitled"}.gabext`)}),GAwesomeUtil.loadSource=((e,t,s)=>(GAwesomeData.extensions.source||(GAwesomeData.extensions.source={}),GAwesomeData.extensions.source[e]?GAwesomeUtil.showSource(e,t,s,GAwesomeData.extensions.source[e]):$.get(`/extensions/${e}?v=${t}`,o=>(GAwesomeData.extensions.source[e]=o,GAwesomeUtil.showSource(e,t,s,o)),"text"))),GAwesomeUtil.showSource=((e,t,s,o)=>{$("#extension-source-download").attr({href:`/extensions/${e}?v=${t}`,download:`${s}.gabext`}),$("#extension-source-name").html(s),GAwesomeData.builder&&document.body.contains(GAwesomeData.builder.getTextArea())||(GAwesomeData.builder=CodeMirror.fromTextArea(document.getElementById("extension-source-viewer"),{mode:"javascript",lineWrapping:!0,lineNumbers:!0,fixedGutter:!0,styleActiveLine:!0,readOnly:!0,theme:"monokai"})),GAwesomeData.builder.setValue(o),$("html").addClass("is-clipped"),$("#extension-source-modal").addClass("is-active"),setImmediate(()=>GAwesomeData.builder.refresh())}),GAwesomeUtil.searchWiki=(e=>{Turbolinks.visit(`/wiki?q=${encodeURIComponent(e)}`)}),GAwesomeUtil.getBookmarkLink=(e=>`${window.location.pathname.split("/").slice(-1)[0]}#${e}`),GAwesomeUtil.bookmarkWikiSection=(e=>{const t=GAwesomeUtil.getBookmarkLink(e.parentNode.id);GAwesomeData.wiki.bookmarks.indexOf(t)>-1?GAwesomeData.wiki.bookmarks.splice(GAwesomeData.wiki.bookmarks.indexOf(t),1):GAwesomeData.wiki.bookmarks.push(t),localStorage.setItem("wiki-bookmarks",JSON.stringify(GAwesomeData.wiki.bookmarks)),$(e).toggleClass("is-dark is-text"),GAwesomeUtil.populateWikiBookmarks()}),GAwesomeUtil.populateWikiSections=(()=>{let e="<ul>";const t=document.getElementById("frame").querySelectorAll("h1, h2, h3");for(let s=0;s<t.length;s++)s>0&&"H3"!==t[s].tagName&&t[s-1]&&"H3"===t[s-1].tagName&&(e+="</ul>"),e+="<li>","H3"===t[s].tagName&&(s>0&&t[s-1]&&"H3"!==t[s-1].tagName||0===s)&&(e+="<ul>"),e+=`<a class='heading-shortcut-link' href='#${t[s].id}' data-turbolinks='false'>${t[s].innerHTML}</a></li>`,t[s].innerHTML+=`&nbsp;<a class='button is-text ${"H3"===t[s].tagName?"is-small":""} heading-shortcut-link' style='text-decoration:none;' href='#${t[s].id}' data-turbolinks='false'><i class='fa fa-link'></i></a>&nbsp;<a class='button ${GAwesomeData.wiki.bookmarks.indexOf(GAwesomeUtil.getBookmarkLink(t[s].id))>-1?"is-dark":"is-text"} ${"H3"===t[s].tagName?"is-small":""}' style='text-decoration:none;' onclick='GAwesomeUtil.bookmarkWikiSection(this);'><i class='fa fa-bookmark'></i></a>`;e+="</ul>",t[t.length-1]&&"H3"===t[t.length-1].tagName&&(e+="</ul>"),$("#submenu").html(e),$("table").addClass("table"),$(".heading-shortcut-link").click(function(){$("html, body").animate({scrollTop:$(`#${this.href.substring(this.href.lastIndexOf("#")+1)}`).offset().top},172)})}),GAwesomeUtil.populateWikiBookmarks=(()=>{if(GAwesomeData.wiki.bookmarks.length>0){$("#bookmarks-menu").removeClass("is-hidden"),$("#menu-spacer").removeClass("is-hidden"),GAwesomeData.wiki.bookmarks=GAwesomeData.wiki.bookmarks.sort();let e="<ul>";for(let t=0;t<GAwesomeData.wiki.bookmarks.length;t++)e+=`<li><a href='${GAwesomeData.wiki.bookmarks[t]}' data-turbolinks='false'>${decodeURI(GAwesomeData.wiki.bookmarks[t]).replace("#"," &raquo; ")}</a></li>`;e+="</ul>",$("#bookmarks-submenu").html(e)}else $("#bookmarks-menu").addClass("is-hidden"),$("#menu-spacer").addClass("is-hidden")}),GAwesomeUtil.isLoading=(e=>$(e).addClass("is-loading")),GAwesomeUtil.isFinished=(e=>$(e).removeClass("is-loading")),GAwesomeUtil.publishExtension=(e=>{confirm("Are you sure you want to publish this extension? Everyone will be able to view and use this extension!")&&(NProgress.start(),$(`#publish-${e}`).remove(),$.ajax({type:"POST",url:`/extensions/${e}/publish`,data:{}}).always(()=>{NProgress.done(),NProgress.remove()}))}),GAwesomeUtil.deleteExtension=((e,t)=>{confirm("Are you sure you want to delete this extension? This action is irreversible!")&&(NProgress.start(),$.ajax({type:"POST",url:`/extensions/${e}/delete`,data:{}}).always(()=>{t?GAwesomeUtil.removeElement($(`#${t}`),null,null):$(`#delete-${e}`).parent().parent().remove(),NProgress.done(),NProgress.remove()}))}),GAwesomeUtil.saveExtension=((e,t)=>{NProgress.start(),GAwesomeData.HUM=!0;const s=$("#form").serializeArray();s.find(e=>"code"===e.name).value=GAwesomeData.builder.getValue(),$.ajax({method:"POST",url:e?t:window.location.pathname+window.location.search,data:s}).always(s=>{const o=$("#form-submit");NProgress.done(),NProgress.remove(),GAwesomeUtil.SFS(),"OK"!==s&&200!==s.status&&302!==s.status?(o.find("span:nth-child(1)").html("<i class='fa fa-exclamation'></i>"),o.find("span:nth-child(2)").html("Error")):e?Turbolinks.visit("/extensions/my"):Turbolinks.visit(t)})}),GAwesomeUtil.voteExtension=(e=>{const t=$(`#vote-${e}`),s=t.html().trim();t.html("-1"===s?"+1":"-1"),$.post(`/extensions/${e}/upvote`);const o=$(`#points-${e}`);o.html("-1"===s?Number(o.html())-1:Number(o.html())+1)}),GAwesomeUtil.unpublishExtension=(e=>{if(!confirm("Are you sure you want to unpublish this extension? It will no longer be usable or visible by guilds, points are preserved."))return;NProgress.start();const t=$(`#card-${e}`);$.post(`/extensions/${e}/unpublish`),t.remove(),NProgress.done(),NProgress.remove()}),GAwesomeUtil.rejectExtension=(e=>{let t=prompt("Reason to reject:");if(""===t)t="No reason given.";else if(null===t)return;NProgress.start(),$.ajax({method:"POST",url:`/extensions/${e}/reject`,data:{reason:t}}).done(()=>{$(`#card-${e}`).remove(),NProgress.done(),NProgress.remove()})}),GAwesomeUtil.removeExtension=(e=>{let t=prompt("Reason to remove:");if(""===t)t="No reason given.";else if(null===t)return;NProgress.start(),$.ajax({method:"POST",url:`/extensions/${e}/remove`,data:{reason:t}}).done(()=>{$(`#card-${e}`).remove(),NProgress.done(),NProgress.remove()})}),GAwesomeUtil.acceptExtension=(e=>{NProgress.start(),$.post(`/extensions/${e}/accept`).done(()=>{NProgress.done(),NProgress.remove(),Turbolinks.visit("/extensions/gallery")})}),GAwesomeUtil.featureExtension=(e=>{const t=$(`#feature-${e}`),s="Feature"!==t.html().trim();t.html(s?"Feature":"Unfeature"),$.post(`/extensions/${e}/feature`),$(`#featured-${e}`).html(s?"":'<span class="tag is-primary">Featured</span>&nbsp;')}),GAwesomeUtil.openExtensionInstaller=((e,t,s)=>{GAwesomeUtil.log("Launching extension installer in window");const o=window.screen.width-600,a=window.screen.height-800;GAwesomeData.extensions.window=window.open(`/extensions/${e}/install?v=${t}${s?`&svrid=${s}&update=true`:""}`,"GAB Extension Installer",`height=800,width=600,left=${o/2},top=${a/2}`),GAwesomeData.extensions.window.focus()}),GAwesomeUtil.installExtension=(({target:e})=>{GAwesomeUtil.log("[INSTALLER] Start install");const t=new URLSearchParams(window.location.search),s=$(e);s.addClass("is-loading");const o=`${$(".installer-step-form").serialize()}&v=${t.get("v")}`;GAwesomeUtil.log(`[INSTALLER] Send POST with form data '${o}'`),$.ajax({method:"POST",url:`/dashboard/${t.get("svrid")}/other/extensions`,data:o}).always(e=>{"OK"!==e&&200!==e.status?(GAwesomeUtil.log(`[INSTALLER] Received non-OK status code from POST request. Response Code: ${e.status}`,"error"),swal("Failed to install extension.","Contact support or try again later.","error").then(()=>s.removeClass("is-loading")).catch()):(GAwesomeUtil.log("[INSTALLER] POST request successful."),s.removeClass("is-loading"),swal("Successfully installed extension!","You can now close this window.","success").then(()=>window.close()).catch())})}),GAwesomeUtil.updateExtension=(e=>{GAwesomeUtil.SFS(),NProgress.start(),e.addClass("is-loading");const t=e.data("extid"),s=`${$(`#extension-update-form-${t}`).serialize()}`;$.ajax({method:"POST",url:window.location.pathname,data:s}).always(t=>{NProgress.done(),"OK"!==t&&200!==t.status?swal("Failed to update extension.","Contact support or try again later.","error").then(()=>e.removeClass("is-loading")).catch():e.removeClass("is-loading")})}),GAwesomeUtil.uninstallExtension=(e=>{NProgress.start();const t=$(`#extension-${e}`),s=`${window.location.pathname}/${e}`;GAwesomeUtil.removeElement(t,null,s)}),GAwesomePaths.extensions=(()=>{"/extensions/builder"===window.location.pathname?(setTimeout(()=>GAwesomeUtil.SFS(),0),GAwesomeData.builder=CodeMirror.fromTextArea(document.getElementById("builder-code-box"),{mode:"javascript",lineWrapping:!0,lineNumbers:!0,fixedGutter:!0,styleActiveLine:!0,theme:"monokai"}),GAwesomeData.builder.refresh()):window.location.pathname.endsWith("/install")&&$("#installer-submit").click(GAwesomeUtil.installExtension)}),GAwesomeUtil.updateBlogSubtitle=(()=>{const e=$("#blog-header-subtitle"),t=GAwesomeData.blog.subtitles[Math.floor(Math.random()*GAwesomeData.blog.subtitles.length)];e.fadeOut({duration:500}).queue(s=>{e.html(t),s()}).fadeIn({duration:500})}),GAwesomeUtil.dashboardWrapper=(e=>"dashboard"!==window.location.pathname.split("/")[1]?"This function can only be executed within the dashboard.":e()),GAwesomeUtil.dashboard.connect=(()=>GAwesomeUtil.dashboardWrapper(()=>{GAwesomeData.dashboard.socket&&(GAwesomeUtil.log("Closing stale Dashboard socket"),GAwesomeData.dashboard.socket.close()),GAwesomeUtil.log("Opening new Dashboard socket"),GAwesomeData.dashboard.socket=io(window.location.pathname,{transports:["websocket"]}),GAwesomeData.dashboard.socket.on("update",e=>{GAwesomeUtil.log(`Received Socket data: ${JSON.stringify(e)}`),GAwesomeData.HUM||GAwesomeData.dashboard.svrid!==e.location||"none"===localStorage.getItem("dashboardUpdates")||($("html").addClass("is-clipped"),$("#update-modal").addClass("is-active"))}),GAwesomeData.dashboard.socket.on("err",e=>{GAwesomeUtil[e.fatal?"error":"warn"](`Dashboard Socket responded with a ${e.error} error code.`)}),GAwesomeData.dashboard.socket.on("logs",e=>{const t=`[${e.timestamp}] [${e.level}] ${e.message}`;GAwesomeData.dashboard.terminal.print(t),$(".Terminal").animate({scrollTop:$(".Terminal").prop("scrollHeight")},500)})})),GAwesomeUtil.dashboard.setCache=((e,t,s,o=300)=>{GAwesomeData.cache||(GAwesomeData.cache=new Map),GAwesomeData.cache.has(e)||GAwesomeData.cache.set(e,new Map),GAwesomeData.cache.get(e).set(t,{data:s,expireAt:Math.floor(Date.now()/1e3)+o})}),GAwesomeUtil.dashboard.getCache=((e,t)=>{if(!GAwesomeData.cache||!GAwesomeData.cache.has(e)||!GAwesomeData.cache.get(e).has(t))return;const s=GAwesomeData.cache.get(e).get(t);if(!(s.expireAt<Math.floor(Date.now()/1e3)))return s.data;GAwesomeData.cache.get(e).delete(t)}),GAwesomeUtil.removeElement=((e,t,s)=>{const o=()=>{e.fadeOut(400,()=>{const s=e.is(":only-child");e.remove(),s&&(t&&t.addClass("is-hidden"),$(".no-elements-message").removeClass("is-hidden")),GAwesomeUtil.SFS(),NProgress.done(),NProgress.remove()})};s?$.ajax({url:s,method:"DELETE"}).always(o):o()}),GAwesomeUtil.dashboard.removeTableElement=(e=>GAwesomeUtil.dashboardWrapper(()=>{const t=$(e);t.addClass("is-loading");const s=t.parents("tr"),o=s.parents("table"),a=t.attr("name");GAwesomeUtil.removeElement(s,o,`${window.location.pathname}/${a}`)})),GAwesomeUtil.dashboard.updateCommandSettings=((e,t)=>{const s=e.find(":input"),o=s.serializeArray(),a=o.filter(e=>e.name.match(/.*-disabled_channel_ids-.*/)).length,i=s.filter((e,t)=>$(t).attr("name").match(/.*-disabled_channel_ids-.*/)).length,n=((e,t,s)=>`${0===e?0===t?"Dis":"En":`Admin level &ge;${e}${0===t?", dis":", en"}`}abled in ${t-s==0||0===t?"all":t} channel${t-s==0||1!==t?"s":""}`)(Number(o.filter(e=>e.name.endsWith("-adminLevel"))[0].value),a,i);t.html(n)}),GAwesomeUtil.dashboard.validateForm=(()=>GAwesomeUtil.dashboardWrapper(()=>{const e=$("#form")[0];return!e||e.reportValidity()})),GAwesomeUtil.dashboard.newRSSFeed=(()=>GAwesomeUtil.dashboardWrapper(()=>{if(!GAwesomeUtil.dashboard.validateForm())return;const e=$("#new-rss-url").val(),t=$("#new-rss-name").val();e&&t&&swal("RSS Feed Checking","Before an RSS Feed can be added, it must first be checked. GAwesomeBot will check the RSS Feed to confirm that it works as expected.",{icon:"info",buttons:{cancel:!0,check:{text:"Check",closeModal:!1}}}).then(s=>"check"===s&&(GAwesomeUtil.SFS(),GAwesomeUtil.dashboard.post({"new-url":e,"new-name":t.toLowerCase()}))).then(e=>e&&swal("RSS Feed successfully added.","","success")).then(e=>{e&&($("#form").submit(),Turbolinks.visit(""))}).catch(()=>{swal("RSS Feed Check Failed","Your RSS Feed could not be verified while checking. Please confirm the URL you supplied is a valid RSS Feed and try again.","error")})})),GAwesomeUtil.dashboard.recheckRSSFeed=(e=>GAwesomeUtil.dashboardWrapper(()=>{swal("RSS Feed Re-checking","Your RSS Feed was disabled because it couldn't be fetched and parsed. You can re-enable Streaming Updates for this RSS Feed by re-checking it.",{icon:"warning",buttons:{cancel:!0,check:{text:"Re-check",closeModal:!1}}}).then(t=>"check"===t&&(GAwesomeUtil.SFS(),GAwesomeUtil.dashboard.post({"recheck-name":e}))).then(e=>e&&swal("RSS Feed successfully re-enabled.","","success")).then(e=>{e&&($("#form").submit(),Turbolinks.visit(""))}).catch(()=>{swal("RSS Feed Re-check Failed","Your RSS Feed could not be verified while checking. Please confirm the feed URL is valid and try again.","error")})})),GAwesomeUtil.dashboard.newStreamer=(()=>GAwesomeUtil.dashboardWrapper(()=>{if(!GAwesomeUtil.dashboard.validateForm())return;const e=$("#new-streamer-name").val(),t=$("#new-streamer-type").val();e&&t&&swal("Streamer Checking","Before a new Streamer can be added, it must first be checked. GAwesomeBot will check the Streamer to confirm that they exist.",{icon:"info",buttons:{cancel:!0,check:{text:"Check",closeModal:!1}}}).then(s=>"check"===s&&(GAwesomeUtil.SFS(),GAwesomeUtil.dashboard.post({"new-name":e,"new-type":t}))).then(e=>e&&swal("Streamer successfully added.","","success")).then(e=>{e&&($("#form").submit(),Turbolinks.visit(""))}).catch(()=>{swal("Streamer Check Failed","Your Streamer was not found. Please confirm the username or ID you supplied and try again.","error")})})),GAwesomeUtil.dashboard.post=(e=>new Promise((t,s)=>{$.ajax({url:window.location.pathname,method:"POST",data:e}).success(t).fail(s)})),GAwesomeUtil.dashboard.setup={},GAwesomeData.dashboard.setup={step:0,maxStep:4},GAwesomeUtil.dashboard.setup.start=(()=>{GAwesomeData.dashboard.setup.step=0;const e=$(".setup-nav-button");e.click(function(){return GAwesomeUtil.dashboard.setup.nav(this)}),GAwesomeUtil.dashboard.setup.nextStep(e)}),GAwesomeUtil.dashboard.setup.nav=(e=>{const t=$(e).data("nav");"next"===t?GAwesomeUtil.dashboard.setup.nextStep(e):"prev"===t&&GAwesomeUtil.dashboard.setup.prevStep(e)}),GAwesomeUtil.dashboard.setup.nextStep=(e=>{const{step:t}=GAwesomeData.dashboard.setup;$(".setup-nav-button[data-nav='prev']").removeAttr("disabled");const s=$(e);s.addClass("is-loading");const o=$(`.setup-step[data-step=${t}]`),a=$(`.setup-step[data-step=${t+1}]`);o.addClass("is-completed is-success").removeClass("is-active"),a.addClass("is-active");const i=$(".setup-content"),n=$(`.setup-content-item[data-step=${t}]`),r=$(`.setup-content-item[data-step=${t+1}]`);GAwesomeUtil.scrollToTop($(".setup-progress")),i.slideUp(1e3,()=>{if(n.removeClass("is-active"),r.addClass("is-active"),t+1===GAwesomeData.dashboard.setup.maxStep&&s.html("Finish"),t===GAwesomeData.dashboard.setup.maxStep)return GAwesomeUtil.dashboard.setup.save();setTimeout(()=>{i.slideDown(1e3),s.removeClass("is-loading")},1e3),GAwesomeData.dashboard.setup.step++})}),GAwesomeUtil.dashboard.setup.prevStep=(e=>{const{step:t}=GAwesomeData.dashboard.setup;if(t<2)return;$(".setup-nav-button[data-nav='next']").html("Next");const s=$(e);s.addClass("is-loading");const o=$(`.setup-step[data-step=${t}]`),a=$(`.setup-step[data-step=${t-1}]`);o.removeClass("is-active"),a.removeClass("is-completed is-success").addClass("is-active");const i=$(".setup-content"),n=$(`.setup-content-item[data-step=${t}]`),r=$(`.setup-content-item[data-step=${t-1}]`);GAwesomeUtil.scrollToTop($(".setup-progress")),i.slideUp(1e3,()=>{n.removeClass("is-active"),r.addClass("is-active"),2===t&&s.attr("disabled",!0),setTimeout(()=>{i.slideDown(1e3),s.removeClass("is-loading")},1e3),GAwesomeData.dashboard.setup.step--})}),GAwesomeUtil.dashboard.setup.save=(()=>{const e=$("form").serialize();GAwesomeUtil.SFS(),$.ajax({method:"POST",url:location.pathname+location.search,data:e}).always(()=>{Turbolinks.visit("./overview")})}),GAwesomePaths.landing=(()=>{$(".section-shortcut-link").click(function(){$("html, body").animate({scrollTop:$(`#${this.href.substring(this.href.lastIndexOf("#")+1)}`).offset().top},172)})}),GAwesomePaths.activity=(()=>{GAwesomeUtil.activityViewportUpdate(GAwesomeListeners.activityMQL),"/activity/users"===window.location.pathname?(document.getElementById("search-button").href="javascript:GAwesomeUtil.searchUsers(document.getElementById('search-input').value);",document.getElementById("search-input").onkeydown=function(){13===event.keyCode&&GAwesomeUtil.searchUsers(this.value)},$.getJSON("/api/list/users",e=>{GAwesomeData.searchInputAutocomplete=new AutoComplete({selector:"#search-input",minChars:2,source:(t,s)=>{t=t.toLowerCase(),s(e.filter(e=>e.toLowerCase().indexOf(t)>-1))}})})):(GAwesomeData.activity.guildData={},document.getElementById("search-button").href="javascript:GAwesomeUtil.searchServers(document.getElementById('search-input').value);",document.getElementById("search-input").setAttribute("list","servers"),document.getElementById("search-input").onkeydown=function(){13===event.keyCode&&GAwesomeUtil.searchServers(this.value)},$.getJSON("/api/list/servers",e=>{GAwesomeData.searchInputAutocomplete=new AutoComplete({selector:"#search-input",minChars:2,source:(t,s)=>{t=t.toLowerCase(),s(e.filter(e=>e.toLowerCase().indexOf(t)>-1))}})}),GAwesomeUtil.switchActivityLayout(),GAwesomeUtil.showActivitySelections())}),GAwesomePaths.blog=(()=>{if(setTimeout(()=>{GAwesomeUtil.SFS()},0),$("#blog-header-subtitle")[0]&&GAwesomeUtil.setInterval(GAwesomeUtil.updateBlogSubtitle,6e4),!window.location.toString().endsWith("/compose")&&!window.location.toString().endsWith("/new"))return;const e=new showdown.Converter({tables:!0,simplifiedAutoLink:!0,strikethrough:!0,tasklists:!0,smoothLivePreview:!0,smartIndentationFix:!0});GAwesomeData.blog.editor=new SimpleMDE({element:document.getElementById("composer-content"),forceSync:!0,spellChecker:!1,promptURLs:!0,previewRender:t=>($(".editor-preview").addClass("content"),$(".editor-preview-side").addClass("content"),e.makeHtml(t))})}),GAwesomePaths.wiki=(()=>{if(setTimeout(()=>{GAwesomeUtil.SFS()},0),GAwesomeData.wiki.bookmarks=JSON.parse(localStorage.getItem("wiki-bookmarks"))||[],GAwesomeUtil.populateWikiBookmarks(),!window.location.toString().endsWith("/edit")&&!window.location.toString().endsWith("/new"))return;const e=new showdown.Converter({tables:!0,simplifiedAutoLink:!0,strikethrough:!0,tasklists:!0,smoothLivePreview:!0,smartIndentationFix:!0});GAwesomeData.wiki.editor=new SimpleMDE({element:document.getElementById("composer-content"),forceSync:!0,spellChecker:!1,promptURLs:!0,previewRender:t=>($(".editor-preview").addClass("content"),$(".editor-preview-side").addClass("content"),e.makeHtml(t))})}),GAwesomePaths.dashboard=(()=>GAwesomeUtil.dashboardWrapper(()=>{switch($(".close-update-modal").unbind(),$(".close-update-modal").click(()=>{$("html").removeClass("is-clipped"),$("#update-modal").removeClass("is-active")}),GAwesomeUtil.dashboard.connect(),window.location.pathname.endsWith("/setup")&&GAwesomeUtil.dashboard.setup.start(),window.location.pathname.split("/")[4]){case"command-options":$("#ban_gif").on("blur",()=>{if("Default"===$("#ban_gif").val())return $("#default_ban_gif").hide(),$("#ban_gif_field").removeClass("has-addons"),$("#ban_gif_preview").attr("src","https://imgur.com/3QPLumg.gif");$("#ban_gif_field").addClass("has-addons"),$("#default_ban_gif").show(),$("#ban_gif_preview").attr("src",$("#ban_gif").val())});break;case"name-display":{const e=$("#currentExample"),t=$("#name_display-use_nick"),s=$("#name_display-show_discriminator");t.click(()=>{t.is(":checked")&&""!==GAwesomeData.nickname?e.text(GAwesomeData.nickname):e.text(GAwesomeData.username),s.is(":checked")&&e.text(`${e.text().trim()}#${GAwesomeData.discriminator}`)}),s.click(()=>{s.is(":checked")?e.text(`${e.text()}#${GAwesomeData.discriminator}`):e.text(e.text().trim().slice(0,-5))});break}case"injection":{const e=document.getElementsByClassName("code-box");GAwesomeData.builders={};for(let t=0;t<e.length;t++){const s=e.item(t);GAwesomeData.builders[s.id]=CodeMirror.fromTextArea(s,{mode:"javascript",lineWrapping:!0,lineNumbers:!0,fixedGutter:!0,styleActiveLine:!0,theme:"monokai"}),GAwesomeData.builders[s.id].on("change",()=>GAwesomeData.builders[s.id].save())}break}case"extension-builder":GAwesomeData.builder=CodeMirror.fromTextArea(document.getElementById("builder-code-box"),{mode:"javascript",lineWrapping:!0,lineNumbers:!0,fixedGutter:!0,styleActiveLine:!0,theme:"monokai"})}})),GAwesomeListeners.activityMQL=window.matchMedia("screen and (max-width: 768px)"),GAwesomeListeners.activityMQL.addListener(GAwesomeUtil.activityViewPortUpdate),document.addEventListener("turbolinks:load",()=>{try{GAwesomeUtil.log("Start load page JS"),GAwesomeUtil.updateHeader(),bulma(),GAwesomeData.timers.forEach((e,t)=>{clearTimeout(e),GAwesomeData.timers.splice(t,1)}),GAwesomeData.HUM=!1,GAwesomeData.IFS=$("#form").serialize(),GAwesomeData.dashboard.socket&&(GAwesomeUtil.log("Closing stale Dashboard socket"),GAwesomeData.dashboard.socket.close(),delete GAwesomeData.dashboard.socket),GAwesomeData.section=window.location.pathname.split("/")[1];let e=GAwesomePaths[GAwesomeData.section];""===GAwesomeData.section&&(e=GAwesomePaths.landing),e&&e(),NProgress.done(!0),GAwesomeUtil.log(`Finished loading page using ${""!==GAwesomeData.section?GAwesomeData.section:"landing"} section handler`)}catch(e){NProgress.done(),NProgress.remove(),GAwesomeUtil.error(`An exception occurred while trying to prepare ${location.pathname}: ${e}`),swal("An exception occurred.",e.toString(),"error")}}),$(document).on("turbolinks:click",({originalEvent:e})=>{const t=document.createElement("a");t.href=e.data.url;const s=t.pathname.startsWith("/dashboard")&&"/dashboard"!==t.pathname,o=window.location.pathname.startsWith("/dashboard")&&"/dashboard"!==window.location.pathname;s&&o?NProgress.configure({parent:"section.section.is-white"}):NProgress.configure({parent:"body"}),NProgress.start()}),$(document).on("turbolinks:before-visit",e=>{const t=$("#form").serialize();if(GAwesomeData.IFS!==t){confirm("You have unsaved changes on this page. Are you sure you want to leave this page and discard your changes?")||(e.preventDefault(),NProgress.done(),NProgress.remove())}}),$(window).bind("beforeunload",e=>{const t=$("#form").serialize();if(GAwesomeData.IFS!==t){const t="You have unsaved changes on this page. Do you want to leave this page and discard your changes or stay on this page?";return e.returnValue=t,t}}),$(window).scroll(function(){$("#form-buttons")&&$("#form-buttons").is(":visible")?$("#scroll-top-button-container").css("padding-bottom","75px"):$("#scroll-top-button-container").css("padding-bottom","25px"),$(this).scrollTop()>200&&$(this).scrollTop()<$(document).height()-1200?$("#scroll-top-button-container").fadeIn(86):$("#scroll-top-button-container").fadeOut(86)}),$(window).scroll(()=>{$(window).scrollTop()+$(window).height()>$(document).height()-150&&"none"!==$("#form-buttons").css("display")&&$("#form-buttons").fadeOut(86)}),setInterval(()=>{const e=$("#form").serialize();GAwesomeData.IFS!==e&&(GAwesomeData.HUM=!1),$(window).scrollTop()+$(window).height()<=$(document).height()-150&&(GAwesomeData.IFS!==e&&"none"===$("#form-buttons").css("display")?$("#form-buttons").fadeIn(86):GAwesomeData.IFS===e&&"none"!==$("#form-buttons").css("display")&&$("#form-buttons").fadeOut(86))},1e3);let keys=[];const konami="38,38,40,40,37,39,37,39,66,65",dolphin="68,69,76,73,71,72,84,69,68,32,68,79,76,80,72,73,78",unknown="38c972419c82c3059933ecefee492ad2";window.addEventListener("keydown",e=>{16!==e.keyCode&&keys.push(e.keyCode),keys.toString().includes(konami)&&(keys=[],document.body.innerHTML=document.body.innerHTML.replace(/GAwesomeBot/g,"TacoBot"),document.body.innerHTML=document.body.innerHTML.split("/static/img/icon.png").join("/static/img/tinytaco.png"),document.getElementById("header").style.backgroundImage="url('/static/img/header-bg-taco.jpg')"),keys.toString().includes(dolphin)&&(keys=[],$("*").contents().filter(function(){return this.nodeType===Node.TEXT_NODE&&""!==this.nodeValue.trim()}).each(function(){let e="";for(let t=0;t<this.nodeValue.length;t++)e+="ðŸ¬";this.nodeValue=e})),md5(keys.toString())===unknown&&(keys=[],document.body.innerHTML=document.body.innerHTML.split("/GilbertGobbels/GAwesomeBot").join("/BitQuote/AwesomeBot"),document.body.innerHTML=document.body.innerHTML.replace(/GAwesomeBot/g,"AwesomeBot Neo"),document.body.innerHTML=document.body.innerHTML.split("/static/img/icon.png").join("/static/img/NEO.png"),$("#footerText").html('<strong>AwesomeBot NEO</strong> by BitQuote & <a href="https://github.com/BitQuote">BitQuote</a>. Made with <a href="https://github.com/BitQuote">BitQuote</a> and <a href="https://github.com/BitQuote">BitQuote</a>. Site made with <a href="https://github.com/BitQuote">BitQuote</a> and <a href="https://github.com/BitQuote">BitQuote</a>. Artwork by <a href="https://github.com/BitQuote">BitQuote</a> and <a href="https://github.com/BitQuote">BitQuote</a>. All rights reserved by BitQuote.'),$(".developer-card-name").html("BitQuote").attr("ondblclick",""),$(".developer-card-icon").attr("src","/static/img/bitquote.png"),$(".developer-card-role").html("(Evil) Creator, Bot Killer"))},!0);
